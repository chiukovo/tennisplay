# Copilot Instructions

- App type: Laravel 8 backend with a single Blade-rendered Vue SPA. Public routes all return the same index view; API lives under /api and uses Sanctum auth.
- SPA entry: [resources/views/index.blade.php](resources/views/index.blade.php) includes [resources/views/partials/vue-scripts.blade.php](resources/views/partials/vue-scripts.blade.php) for all Vue logic (routing table, state, API calls). Vue routing uses the History API with paths like `/`, `/list`, `/create`, `/messages`, `/auth`, `/mycards`, `/events`, `/create-event` mapped in the script.
- Backend routing: Web routes in [routes/web.php](routes/web.php) return the SPA view. API routes in [routes/api.php](routes/api.php) expose players, events, messages, and auth endpoints; authenticated actions require `auth:sanctum`.
- Key models/controllers: Players ([app/Models/Player.php](app/Models/Player.php) and [app/Http/Controllers/Api/PlayerController.php](app/Http/Controllers/Api/PlayerController.php)), Events ([app/Models/Event.php](app/Models/Event.php) and [app/Http/Controllers/Api/EventController.php](app/Http/Controllers/Api/EventController.php)), Messages ([app/Models/Message.php](app/Models/Message.php) and [app/Http/Controllers/Api/MessageController.php](app/Http/Controllers/Api/MessageController.php)), plus LINE login in [app/Http/Controllers/Api/AuthController.php](app/Http/Controllers/Api/AuthController.php).
- API conventions: Most endpoints return JSON via controller methods; pagination via `paginate` on event index; create/update routes validate request payloads server-side. Event creation auto-adds organizer as confirmed participant.
- Auth flow: LINE login endpoints at `/auth/line` and `/auth/line/callback` (see [routes/web.php](routes/web.php) and AuthController). SPA stores `auth_user` in localStorage and uses Sanctum tokens for authenticated API calls.
- Data rules:
  - Events: `status` values include open/full/closed/cancelled; `is_full` computed on model (check [app/Models/Event.php](app/Models/Event.php)). Join/leave endpoints adjust status to full/open.
  - Players: `level` and region options are defined client-side constants in the Vue script; photo upload endpoint at `/api/players/{id}/photo`.
  - Messages: inbox/sent/chat endpoints; unread count at `/api/messages/unread-count`.
- Frontend patterns: No Vite; uses Laravel Mix 6. Vue code is inline (Options API inside `createApp` in the partial). API helper `api` wraps axios and injects token; routes map is a plain object, not vue-router.
- Builds/asset pipeline: `npm install` then `npm run dev` (or `npm run prod`) to build assets via Mix. CSS/JS sources live under `resources/`.
- Backend setup: `composer install`, copy `.env`, set DB connection, run `php artisan key:generate`, then migrate/seed (`php artisan migrate --seed` uses seeders in [database/seeders](database/seeders)). PHP requirement ^7.3 or ^8.0 per composer.
- Testing: PHPUnit configured (see [phpunit.xml](phpunit.xml)); no custom test helpers beyond default `Tests\` namespace.
- Common pitfalls:
  - Refreshing SPA routes must be whitelisted in [routes/web.php](routes/web.php); add new SPA paths here to avoid 404s.
  - File uploads require public disk storage symlink (`php artisan storage:link`).
  - Keep API under `/api` prefix so SPA history routes donâ€™t collide.
- Example workflows:
  - List events: GET `/api/events` (supports `status`, `region`, `match_type`, `search`, `per_page`).
  - Create event: POST `/api/events` with form fields; organizer auto-joins.
  - Join/leave: POST `/api/events/{id}/join` or `/api/events/{id}/leave`; status flips full/open based on capacity.
  - Fetch current user: GET `/api/user` with Sanctum token.
- When adding frontend routes, also add corresponding SPA view returns in web routes and map the path/name in the Vue `routes` object.
